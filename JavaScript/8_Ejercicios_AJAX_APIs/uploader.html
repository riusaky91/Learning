<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploader con AJAX</title>

<style>
    html {
    box-sizing: border-box; /*resetea el borde*/
    font-family: sans-serif; /*tipo de Fuente*/
    font-size: 16px; /*tamaño de fuente*/
  }

    *,/*todos los elementos*/
    *:before,/*todos los elementos antes*/
    *:after {
    /*todos los elementos antes*/
    box-sizing: inherit; /*Herede el borde del padre tamaño de las cajas empezaran desde el borde*/
  }

  main{
    display: flex;/*Manejo de flex box*/
    flex-direction: column;/*Manejo columnar para el elemento*/
    justify-content: center;/*Centrado en el eje principal*/
    align-items: center;/*Centrado en el eje horizontal*/
    text-align: center;/*Centrado del texto*/
    min-height: 100vh;/*altura minima para la vista en el documento*/
  }
</style>
</head>
<body>
    <main>
        <input type="file" id="files" name="files" multiple>
    </main>
    <script>
        const d = document,//declar e inicializo la variable d coon la palabra reservada document
        $main = d.querySelector("main"),//declaro e inicializo la varable $main con el elmento de tipo main
        $files = d.getElementById("files");//declaro e inicializo la variable con el elemento que tiene como id files

        const uploader = async (file) =>{//declaro funcion expresada asincrona que recibe la varable file para su ejecucion
            console.log(file);
            const formData = new FormData();//Declaro en inicializo contante con el valor de un objeto tipo FormData

            formData.append("file",file);//al form data le agrego la variable file que contiene el archivo

            try {
                let res = await fetch("assets/uploader.php", //URL del end point
                {
                    method: "POST", //metodo a utilizar de la peticion
                    body: formData //cuerpo de la peticion
                    //headers: { "enc-type","multipart/form-data" }//Cabecera con la naturaleza delos datos a enviar
                }); //declaro e inicializo variable que detendra la ejecucion del codigo hasta que traiga los recursos solicitados en fetch y los alamcene ne la variable
             
                if (!res.ok) {
                    //Si la respuesta no es satisfactoria o esta fallando
                    throw { status: res.status, statusText: res.statusText }; //dentro del try catch para enviar al catch se utiliza el throw
                }

                let json = await res.json(); //declaro e inicializo variable que detendra la ejecucion del codigo hasta que reciba la respuesta html y los alamcene en la variable
                
                console.log(json);
            } catch (error) {
                console.log(error); //Ejecuto el metodo error del objeto enviado
            }


        }

        d.addEventListener("change", e =>{//Metodo tipo evento qque se ejecuta cuando hay un cambio en el docuemnto
            if(e.target === $files){
                console.log(e.target.files);

                const files = Array.from(e.target.files);//declaro e inicializo constante files que convierte en arreglo iterable
                files.forEach(e=>{//recorro la constante y por cada iteracion de un archivo
                    uploader(e);//ejecuto el metodo uploader
                });

            }
        })
    </script>
</body>
</html>